<elm-page-header class="page-header" (breadcrumbClick)="router.navigate([$event])" [breadcrumbs]="breadcrumbs"
                 headerTitle="Invoice {{falconInvoiceNumber}}"
                 headerSubtitle="Status: {{invoiceStatus}}">
  <div class="d-flex justify-content-end header-button">
    <div *ngIf="hasInvoiceWrite" class="col-12 d-flex justify-content-end">
      <elm-button id="save-as-template-button"
                  buttonType="button"
                  buttonStyle="text"
                  class="flex-shrink-1"
                  (buttonClick)="clickSaveAsTemplateButton()">
        <u>Save as Template</u>
      </elm-button>
      <elm-button id="delete-button"
                  buttonType="button"
                  buttonStyle="secondary"
                  class="flex-shrink-1 header-button"
                  [isDisabled]="(isGlobalEditMode$.value || isDeletedInvoice
                          || (!isEditableInvoice && !(isAutoInvoice && isApprovedInvoice)))"
                  (buttonClick)="clickDeleteButton()">
        Delete
      </elm-button>
      <elm-button id="edit-button"
                  buttonType="button"
                  buttonStyle="primary"
                  class="flex-shrink-1 header-button"
                  [isDisabled]="isGlobalEditMode$.value
                            || isDeletedInvoice
                            || !isEditableInvoice"
                  (buttonClick)="clickToggleEditMode()">
        Edit
      </elm-button>
    </div>
  </div>
</elm-page-header>
<mat-toolbar *ngIf="showEditInfoBanner" class="margin-b-24">
  <div class="headline3 w-100 text-center text-danger">
    <span><strong>ATTENTION:</strong> To update and apply changes, click the <strong>"SAVE"</strong> button</span>
    <span role="button" class="material-icons material-icons-outlined close-icon" (click)="clickCloseBanner()">close</span>
  </div>
</mat-toolbar>
<elm-card>
  <mat-sidenav-container class="side-nav-container"
                         [hasBackdrop]="false">
    <mat-sidenav class="side-nav"
                 [fixedInViewport]="false"
                 mode="side" position="end"
                 [opened]="isMilestoneTabOpen">
      <!-- Milestone Panel -->
      <app-milestone-panel [milestones]="milestones">
      </app-milestone-panel>
    </mat-sidenav>

    <mat-sidenav-content class="side-nav-content">
      <form [formGroup]="invoiceFormGroup">
        <elm-button *ngIf="showMilestoneToggleButton"
                    id="milestones-button"
                    class="milestone-button"
                    (buttonClick)="clickToggleMilestoneTab()"
                    mat-dialog-close>
          Milestones
        </elm-button>

        <!-- Invoice Overview -->
        <app-invoice-overview
          [loadInvoiceOverviewDetail$]="loadInvoiceOverviewDetail$.asObservable()"

        >
        </app-invoice-overview>
        <hr/>

        <!-- Trip Information -->
        <app-trip-information [formGroup]="tripInformationFormGroup"
                              [loadTripInformation$]="loadTripInformation$.asObservable()"
                              [updateIsEditMode$]="isTripEditMode$.asObservable()"
                              (updateAndContinueClickEvent)="handleTripEditModeEvent($event)"
                              (openWeightAdjustmentModalEvent)="handleWeightAdjustmentModalEvent($event)">
        </app-trip-information>
        <hr/>

        <app-invoice-amount
         [formGroup]="invoiceAmountFormGroup"
         [userInfo]="userInfo"
         [updateIsEditMode$]="otherSectionEditMode$.asObservable()"
         [loadInvoiceAmountDetail$]="loadInvoiceAmountDetail$.asObservable()"
         [loadInvoiceOverviewDetail$]="loadInvoiceOverviewDetail$.asObservable()"
         [chargeLineItemOptions$]="chargeLineItemOptions$.asObservable()"
         (costBreakdownAmountInvalid)="handleFormIfInvalid($event)"
         (getAccessorialDetails)="getAccessorialList()"
         (rateEngineCall)="getRates($event)"
         (requestGlAllocation)="onGlAllocationRequestEvent($event)"
         (resolveDisputeCall)="disputeAction($event)"
         >
        </app-invoice-amount>
        <hr>

        <!-- Allocation -->
        <app-invoice-allocation
        [formGroup]="invoiceAllocationFormGroup"
        [updateIsEditMode$]="otherSectionEditMode$.asObservable()"
        [loadAllocationDetails]="loadAllocationDetails$.asObservable()"
        [loadInvoiceOverviewDetail$]="loadInvoiceOverviewDetail$.asObservable()"
        (allocationAmountInvalid)="handleFormIfInvalid($event)"
        >
        </app-invoice-allocation>
        <hr/>

        <!-- FORM FOOTER -->
        <div id="form-footer"
             class="d-flex justify-content-between">

          <!-- CANCEL -->
          <elm-button id="cancel-button"
                      buttonType="button"
                      buttonStyle="text"
                      class="flex-shrink-1"
                      (buttonClick)="clickCancelButton()">
            <u>Cancel</u>
          </elm-button>

          <div *ngIf="hasInvoiceWrite" class="flex-shrink-1">
            <!-- SAVE -->
            <elm-button id="save-button"
                        buttonType="button"
                        buttonStyle="secondary"
                        class="fake-form-control"
                        [isDisabled]="!otherSectionEditMode$.value || !invoiceFormGroup.valid || !tripInformationComponent.carrierDetailFound || !this.costBreakdownValid || !this.netAllocationAmountValid"
                        (buttonClick)="clickSaveButton()">
              Save
            </elm-button>

            <!-- SUBMIT FOR APPROVAL -->
            <elm-button id="submit-for-approval-button"
                        buttonType="button"
                        buttonStyle="primary"
                        class="fake-form-control"
                        [isDisabled]="!invoice.payable || !otherSectionEditMode$.value || !invoiceFormGroup.valid || !tripInformationComponent.carrierDetailFound || !this.costBreakdownValid || !this.netAllocationAmountValid"
                        (buttonClick)="clickSubmitForApprovalButton()">
              Submit for Approval
            </elm-button>
          </div>
        </div>

      </form>
    </mat-sidenav-content>
  </mat-sidenav-container>
</elm-card>
