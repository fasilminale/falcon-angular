<div id="container">
  <elm-button *ngIf="enableMilestones"
              id="milestones-button"
              class="milestone-button"
              (buttonClick)="toggleSidenav()"
              mat-dialog-close>
    Milestones
  </elm-button>
  <div class="content">
    <form [formGroup]="invoiceFormGroup"
          (ngSubmit)="onSubmit()">

      <div class="row me-0">

        <div class="row col-12 col-lg-6 me-1">
          <!-- WORK TYPE -->
          <div class="col-12">
            <label for="work-type-input" class="form-label fieldLabel1">
              Work Type
            </label>
            <ng-select id="work-type-input"
                       formControlName="workType"
                       [items]="workTypeOptions"
                       [searchable]="true"
                       placeholder="Select One...."
                       [ngClass]="{ 'error': workType.errors && workType.hasError('required'), 'disabled': readOnly }">
            </ng-select>
            <small class="error-text"
                   *ngIf="workType.hasError('required')">
              Work Type is required
            </small>
          </div>

          <!-- COMPANY CODE -->
          <div class="col-12">
            <label for="company-code-input" class="form-label fieldLabel1">
              Company Code
            </label>
            <input type="text"
                   id="company-code-input"
                   formControlName="companyCode"
                   class="form-control"
                   (keypress)="validateRegex($event)"
                   maxlength="4"
                   [ngClass]="companyCode.errors && companyCode.hasError('required') ? 'error' : ''"
            />
            <small class="error-text"
                   *ngIf="companyCode.hasError('required')">
              Company Code is required
            </small>
          </div>

          <!-- ERP TYPE -->
          <div class="col-12">
            <label for="erp-type-input" class="form-label fieldLabel1">
              ERP Type
            </label>
            <app-fal-radio-input id="erp-type-input"
                                 formControlName="erpType"
                                 [options]="erpTypeOptions"
                                 [isDisabled]="readOnly"
                                 [isError]="!!(erpType.errors && erpType.hasError('required'))">
            </app-fal-radio-input>
            <small class="error-text"
                   *ngIf="erpType.hasError('required')">
              ERP Type is required
            </small>
          </div>

          <!-- VENDOR NUMBER -->
          <div class="col-12 col-md-6">
            <label for="vendor-number-input" class="form-label fieldLabel1">
              Vendor Number
            </label>
            <input type="text"
                   id="vendor-number-input"
                   class="form-control"
                   formControlName="vendorNumber"
                   (keypress)="validateRegex($event)"
                   maxlength="10"
                   [ngClass]="vendorNumber.errors && vendorNumber.hasError('required')? 'error' : ''"
            />
            <small class="error-text"
                   *ngIf="vendorNumber.hasError('required')">
              Vendor Number is required
            </small>
          </div>

          <!-- EXTERNAL INVOICE NUMBER -->
          <div class="col-12 col-md-6">
            <label for="external-invoice-number-input" class="form-label fieldLabel1">
              External Invoice Number
            </label>
            <input type="text"
                   id="external-invoice-number-input"
                   class="form-control"
                   formControlName="externalInvoiceNumber"
                   (keypress)="validateRegex($event)"
                   maxlength="16"
                   [ngClass]="externalInvoiceNumber.errors && externalInvoiceNumber.hasError('required')? 'error' : ''"
            />
            <small class="error-text"
                   *ngIf="externalInvoiceNumber.hasError('required')">
              External Invoice Number is required
            </small>
          </div>

          <!-- EXTERNAL INVOICE DATE -->
          <div class="col-12 col-md-5">
            <label for="external-invoice-date-input" class="form-label fieldLabel1">
              External Invoice Date
            </label>
            <app-fal-date-input id="external-invoice-date-input"
                                formControlName="invoiceDate"
                                [isDisabled]="readOnly"
                                [isError]="!!(invoiceDate.errors && (invoiceDate.hasError('required') || invoiceDate.hasError('validateDate')))">
            </app-fal-date-input>
            <small class="error-text"
                   *ngIf="invoiceDate.hasError('required')">
              External Invoice Date is required
            </small>
            <small class="error-text"
                   *ngIf="invoiceDate.hasError('validateDate')">
              Invoice Date is invalid
            </small>
          </div>


          <!-- INVOICE AMOUNT -->
          <div class="col-12 col-sm-6 col-md-4">
            <label for="invoice-amount-input" class="form-label fieldLabel1">
              Invoice Net Amount
            </label>
            <input type="text"
                   class="form-control"
                   mvndrMatCurrencyFormat
                   [allowNegative]="true"
                   [value]="amountOfInvoiceFormControl.value"
                   id="invoice-amount-input"
                   [ngClass]="((amountOfInvoiceFormControl.errors && amountOfInvoiceFormControl.hasError('required')) || !validAmount) ? 'error' : ''"
                   formControlName="amountOfInvoice"
            />
            <small class="error-text"
                   *ngIf="amountOfInvoiceFormControl.hasError('required')">
              Invoice Net Amount is required
            </small>
          </div>

          <!-- CURRENCY -->
          <div class="col-12 col-sm-6 col-md-3">
            <label for="currency-input" class="form-label fieldLabel1">
              Currency
            </label>
            <ng-select id="currency-input"
                       formControlName="currency"
                       [items]="currencyOptions"
                       [searchable]="true"
                       placeholder="Select One...."
                       [ngClass]="{ 'error': currency.errors && currency.hasError('required'), 'disabled': readOnly }">
            </ng-select>
            <small class="error-text"
                   *ngIf="currency.hasError('required')">
              Currency is required
            </small>
          </div>
        </div>

        <!-- UPLOAD DOCUMENT SECTION -->
        <div class="row col-12 col-lg-6">
          <form [formGroup]="attachmentFormGroup"
                (ngSubmit)="addAttachment()">
            <label class="form-label fieldLabel1">
              Upload Attachments (optional)
            </label>
            <div class="form-control upload-container">
              <div class="row">
                <div class="col-12 fieldLabel3">
                  Supported file types: eml, doc, jpg, pdf, xlsx
                </div>

              </div>
              <div class="row">
                <div class="col-6">
                  <!-- FILE CHOOSER -->
                  <label for="file-chooser-input"
                         class="form-label fieldLabel1">
                    File
                  </label>
                  <app-fal-file-input id="file-chooser-input"
                                      formControlName="file"
                                      accept=".eml, .doc, .jpg, .pdf, .xlsx"
                                      [isDisabled]="readOnly">
                  </app-fal-file-input>
                  <div class="form-label fieldLabel1 p-1">
                    Maximum file size ???MB
                  </div>

                  <!-- ATTACHMENT TYPE -->
                  <label for="attachment-type-input"
                         class="form-label fieldLabel1">
                    Document Type
                  </label>
                  <ng-select id="attachment-type-input"
                             formControlName="attachmentType"
                             [items]="attachmentTypeOptions"
                             [searchable]="true"
                             placeholder="Select One...."
                             [ngClass]="{ 'disabled': readOnly }">
                  </ng-select>

                  <!-- UPLOAD BUTTON -->
                  <div id="upload-button-container">
                    <elm-button buttonType="submit"
                                buttonStyle="primary"
                                [isDisabled]="!(attachmentFormGroup.controls.file.value && attachmentFormGroup.controls.attachmentType.value)">
                      Upload
                    </elm-button>
                  </div>
                </div>

                <div class="col-6 upload-file-div">
                  <!-- ATTACHMENTS LOOP-->
                  <div *ngFor="let attachment of attachments; index as i"
                       class="attachment form-control d-flex align-items-center justify-content-between">

                    <!-- ATTACHMENT - ICON -->
                    <div class="material-icons">file_present</div>

                    <!-- ATTACHMENT - CONTENT -->
                    <div class=" flex-grow-1 p-1">
                      {{attachment.file.name}}&nbsp;({{attachment.type}})
                    </div>

                    <!-- ATTACHMENT - REMOVE -->
                    <input *ngIf="!readOnly" type="button"
                           value="close"
                           class="material-icons btn btn-remove-attachment"
                           (click)="removeAttachment(i)"
                    />
                  </div>
                </div>

              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="row">

        <!-- LINE ITEMS -->
        <cardinal-card id="line-items-card"
                       formArrayName="lineItems">
          <cardinal-section-header [sectionTitle]="'Line Items'">
          </cardinal-section-header>

          <!-- LINE ITEM - LOOP -->
          <div id="line-item-rows-container">
            <div *ngFor="let _ of lineItemsFormArray.controls; index as i"
                 class="line-item-row d-flex flex-nowrap justify-content-between align-items-end"
                 [formGroupName]="i">

              <!-- LINE ITEM - NUMBER -->
              <div class="flex-shrink-1">
                <label class="form-label fieldLabel1">
                  &nbsp;
                </label>
                <div class="fake-form-control">
                  {{i + 1}}
                </div>
              </div>

              <!-- LINE ITEM - COMPANY CODE -->
              <div>
                <label class="form-label fieldLabel1">
                  Company Code
                </label>
                <input type="text"
                       class="form-control"
                       formControlName="companyCode"
                       [placeholder]="invoiceFormGroup.controls.companyCode.value"
                       (keypress)="validateRegex($event)"
                       maxlength="4"
                />
              </div>

              <!-- LINE ITEM - COST CENTER -->
              <div>
                <label class="form-label fieldLabel1">
                  Cost Center
                </label>
                <input type="text"
                       class="form-control"
                       formControlName="costCenter"
                       (keypress)="validateRegex($event)"
                       maxlength="10"
                       [ngClass]="lineItemCostCenter(i).errors && lineItemCostCenter(i).hasError('required') ? 'error' : ''"
                />
              </div>

              <!-- LINE ITEM - GL ACCOUNT -->
              <div>
                <label class="form-label fieldLabel1">
                  GL Account
                </label>
                <input type="text"
                       class="form-control"
                       formControlName="glAccount"
                       (keypress)="validateRegex($event)"
                       maxlength="10"
                       [ngClass]="lineItemGlAccount(i).errors && lineItemGlAccount(i).hasError('required') ? 'error' : ''"
                />
              </div>

              <!-- LINE ITEM - NET AMOUNT -->
              <div>
                <label class="form-label fieldLabel1">
                  Line Net Amount
                </label>
                <input type="text"
                       mvndrMatCurrencyFormat
                       [allowNegative]="true"
                       [value]="lineItemNetAmountFormControl(i).value"
                       class="form-control"
                       [ngClass]="lineItemNetAmountFormControl(i).errors && lineItemNetAmountFormControl(i).hasError('required') ? 'error' : ''"
                       formControlName="lineItemNetAmount"
                       (keyup)="calculateLineItemNetAmount()"
                />
              </div>

              <!-- LINE ITEM - NOTES -->
              <div class="w-50">
                <label class="form-label fieldLabel1">
                  Notes (optional)
                </label>
                <input type="text"
                       class="form-control"
                       formControlName="notes"
                       (keypress)="validateFreeTextRegex($event)"
                       maxlength="50"
                />
              </div>

              <!-- LINE ITEM - REMOVE -->
              <div class="flex-shrink-1">
                <label class="form-label fieldLabel1">
                  &nbsp;
                </label>
                <input type="button"
                       value="remove_circle"
                       class="material-icons btn line-item-remove-button"
                       [disabled]="lineItemRemoveButtonDisable || readOnly"
                       (click)="removeLineItem(i)"
                />
              </div>

            </div>
          </div>

          <div class="row">
            <!-- LINE ITEMS - ADD NEW -->
            <div class="col-4">
              <elm-button *ngIf="!readOnly"
                buttonType="button"
                buttonStyle="text"
                id="add-new-line-item-button"
                (buttonClick)="addNewEmptyLineItem()">
                <u>+ Add New Line Item</u>
              </elm-button>
            </div>
            <div class="col-1">
              <label class="form-label fieldLabel1 total-line-item-amt">
                ${{totallineItemNetAmount | number : '1.2-2'}}
              </label>
              </div>
              <div class="col-2">
              <label class="form-label fieldLabel1 total-line-item-amt-l">
                Line Net Amount Total
              </label>
            </div>
          </div>
          

        </cardinal-card>

        <!-- FORM FOOTER -->
        <div id="form-footer"
             class="col-12 d-flex justify-content-between">

          <!-- CANCEL -->
          <elm-button id="cancel-button"
                      buttonType="button"
                      buttonStyle="text"
                      class="flex-shrink-1"
                      (buttonClick)="onCancel()">
            <u>Cancel</u>
          </elm-button>

          <!-- SUBMIT -->
          <elm-button id="submit-button"
                      buttonType="submit"
                      buttonStyle="primary"
                      class="flex-shrink-1"
                      [isDisabled]="invoiceFormGroup.invalid || readOnly">
            {{falconInvoiceNumber ? 'Save' : 'Create'}}
          </elm-button>
        </div>

      </div>
    </form>
  </div>
</div>
